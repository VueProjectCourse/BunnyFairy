import{_ as n,c as s,o as a,a as p}from"./app.ba9c527d.js";const d='{"title":"\u5C01\u88C5\u7F51\u7EDC\u8BF7\u6C42","description":"","frontmatter":{},"headers":[],"relativePath":"preparation/network-request.md"}',t={},e=p(`<h1 id="\u5C01\u88C5\u7F51\u7EDC\u8BF7\u6C42" tabindex="-1">\u5C01\u88C5\u7F51\u7EDC\u8BF7\u6C42 <a class="header-anchor" href="#\u5C01\u88C5\u7F51\u7EDC\u8BF7\u6C42" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">\u76EE\u6807</p><p>\u8FD9\u4E00\u5C0F\u8282\uFF0C\u6211\u4EEC\u7684\u76EE\u6807\u662F\u5B9E\u73B0\u9879\u76EE\u4E2D\u7F51\u7EDC\u8BF7\u6C42\u63D2\u4EF6\u7684\u4E8C\u6B21\u5C01\u88C5</p></div><div class="warning custom-block"><p class="custom-block-title">\u6B65\u9AA4</p><ol><li>\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>index.js</code></li><li>\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>axios.setConfig.js</code></li><li>\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>axios.handlerError.js</code></li><li>\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>axios.handleResponse.js</code></li></ol></div><div class="info custom-block"><p class="custom-block-title">\u4F53\u9A8C</p><ul><li><p><strong>Step.1\uFF1A\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>index.js</code></strong></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> setConfig <span class="token keyword">from</span> <span class="token string">&quot;./axios.setConfig.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> handleResponse <span class="token keyword">from</span> <span class="token string">&quot;./axios.handleResponse.js&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> handleError <span class="token keyword">from</span> <span class="token string">&quot;./axios.handleError.js&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// import store from &#39;@/store/index&#39;</span>
<span class="token comment">// import router from &#39;@/router/index.js&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Message <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">showTip</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">tip</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> tip <span class="token operator">||</span> <span class="token string">&quot;\u8BF7\u6C42\u51FA\u9519\u5566&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">duration</span><span class="token operator">:</span> <span class="token number">1500</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * intactRequest\u662F\u53EA\u5728axios\u57FA\u7840\u4E0A\u66F4\u6539\u4E86\u8BF7\u6C42\u914D\u7F6E\u3002
 * \u800Crequest\u662F\u57FA\u4E8Eaxios\u521B\u5EFA\u7684\u5B9E\u4F8B\uFF0C\u5B9E\u4F8B\u53EA\u6709\u5E38\u89C1\u7684\u6570\u636E\u8BF7\u6C42\u65B9\u6CD5\uFF0C\u6CA1\u6709axios.isCancel/ axios.CancelToken\u7B49\u65B9\u6CD5\uFF0C
 * \u4E5F\u5C31\u662F\u6CA1\u6709**\u53D6\u6D88\u8BF7\u6C42**\u548C**\u6279\u91CF\u8BF7\u6C42**\u7684\u65B9\u6CD5\u3002
 * \u6240\u4EE5\u5982\u679C\u9700\u8981\u5728\u5B9E\u4F8B\u4E2D\u8C03\u7528\u53D6\u6D88\u67D0\u4E2A\u8BF7\u6C42\u7684\u65B9\u6CD5\uFF08\u4F8B\u5982\u53D6\u6D88\u4E0A\u4F20\uFF09\uFF0C\u8BF7\u7528intactRequest\u3002
 */</span>
<span class="token keyword">let</span> intactRequest <span class="token operator">=</span> <span class="token function">setConfig</span><span class="token punctuation">(</span>axios<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token function">setConfig</span><span class="token punctuation">(</span>intactRequest<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u8BF7\u6C42\u4E2D\u7684api</span>
<span class="token keyword">let</span> pendingPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * \u8BF7\u6C42\u62E6\u622A
 */</span>
<span class="token keyword">const</span> requestInterceptorId <span class="token operator">=</span> request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u5BF9\u4E8E\u5F02\u5E38\u7684\u54CD\u5E94\u4E5F\u9700\u8981\u5728pendingPool\u4E2D\u5C06\u5176\u5220\u9664\uFF0C\u4F46\u54CD\u5E94\u62E6\u622A\u5668\u4E2D\u7684\u5F02\u5E38\u54CD\u5E94\u6709\u4E9B\u83B7\u53D6\u4E0D\u5230\u8BF7\u6C42\u4FE1\u606F\uFF0C\u8FD9\u91CC\u5C06\u5176\u4FDD\u5B58\u5728\u5B9E\u4F8B\u4E0A</span>
    request<span class="token punctuation">.</span>config <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5728\u53D1\u9001\u8BF7\u6C42\u4E4B\u524D\u505A\u4E9B\u4EC0\u4E48</span>
    <span class="token comment">// config.headers.common[&#39;cookie-id&#39;] = cookieId</span>
    config<span class="token punctuation">.</span>cancelToken <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">axios<span class="token punctuation">.</span>CancelToken</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cancelFn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      pendingPool<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
        <span class="token operator">?</span> <span class="token function">cancelFn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>config<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\u8BF7\u6C42\u91CD\u590D</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
        <span class="token operator">:</span> pendingPool<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> cancelFn<span class="token punctuation">,</span> <span class="token literal-property property">global</span><span class="token operator">:</span> config<span class="token punctuation">.</span>global <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\u8BF7\u6C42\u62E6\u622Aerr:&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// \u5BF9\u8BF7\u6C42\u9519\u8BEF\u505A\u4E9B\u4EC0\u4E48</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * \u54CD\u5E94\u62E6\u622A
 */</span>
<span class="token keyword">const</span> responseInterceptorId <span class="token operator">=</span> request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> config <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
    pendingPool<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// console.log(&#39;\u54CD\u5E94response suc:&#39;, response)</span>
    <span class="token comment">// showTip(err.message);</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">handleResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// \u5BF9\u5F02\u5E38\u54CD\u5E94\u5904\u7406</span>
  <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> config <span class="token punctuation">}</span> <span class="token operator">=</span> request<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> pendingPool<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      err <span class="token operator">=</span> <span class="token function">handleError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// \u6CA1\u6709response(\u6CA1\u6709\u72B6\u6001\u7801)\u7684\u60C5\u51B5</span>
    <span class="token comment">// eg: \u8D85\u65F6\uFF1B\u65AD\u7F51\uFF1B\u8BF7\u6C42\u91CD\u590D\u88AB\u53D6\u6D88\uFF1B\u4E3B\u52A8\u53D6\u6D88\u8BF7\u6C42\uFF1B</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// \u9519\u8BEF\u4FE1\u606Ferr\u4F20\u5165isCancel\u65B9\u6CD5\uFF0C\u53EF\u4EE5\u5224\u65AD\u8BF7\u6C42\u662F\u5426\u88AB\u53D6\u6D88</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>axios<span class="token punctuation">.</span><span class="token function">isCancel</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">axios<span class="token punctuation">.</span>Cancel</span><span class="token punctuation">(</span>
          err<span class="token punctuation">.</span>message <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\u8BF7\u6C42&#39;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>request<span class="token punctuation">.</span>config<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#39;\u88AB\u53D6\u6D88</span><span class="token template-punctuation string">\`</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack <span class="token operator">&amp;&amp;</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;timeout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u8BF7\u6C42\u8D85\u65F6!&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u8FDE\u63A5\u670D\u52A1\u5668\u5931\u8D25!&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">showTip</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// \u79FB\u9664\u5168\u5C40\u7684\u8BF7\u6C42\u62E6\u622A\u5668</span>
<span class="token keyword">function</span> <span class="token function">removeRequestInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">eject</span><span class="token punctuation">(</span>requestInterceptorId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// \u79FB\u9664\u5168\u5C40\u7684\u54CD\u5E94\u62E6\u622A\u5668</span>
<span class="token keyword">function</span> <span class="token function">removeResponseInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">eject</span><span class="token punctuation">(</span>responseInterceptorId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * \u6E05\u9664\u6240\u6709pending\u72B6\u6001\u7684\u8BF7\u6C42
 * @param {Array} whiteList \u767D\u540D\u5355\uFF0C\u91CC\u9762\u7684\u8BF7\u6C42\u4E0D\u4F1A\u88AB\u53D6\u6D88
 * \u8FD4\u56DE\u503C \u88AB\u53D6\u6D88\u4E86\u7684api\u8BF7\u6C42
 */</span>
<span class="token keyword">function</span> <span class="token function">clearPendingPool</span><span class="token punctuation">(</span><span class="token parameter">whiteList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pendingPool<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

  <span class="token comment">// const pendingUrlList = [...pendingPool.keys()].filter((url) =&gt; !whiteList.includes(url))</span>
  <span class="token keyword">const</span> pendingUrlList <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>pendingPool<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>whiteList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pendingUrlList<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

  pendingUrlList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pendingUrl</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// \u6E05\u9664\u6389\u6240\u6709\u975E\u5168\u5C40\u7684pending\u72B6\u6001\u4E0B\u7684\u8BF7\u6C42</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pendingPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pendingUrl<span class="token punctuation">)</span><span class="token punctuation">.</span>global<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pendingPool<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>pendingUrl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cancelFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      pendingPool<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>pendingUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> pendingUrlList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

request<span class="token punctuation">.</span>removeRequestInterceptor <span class="token operator">=</span> removeRequestInterceptor<span class="token punctuation">;</span>
request<span class="token punctuation">.</span>removeResponseInterceptor <span class="token operator">=</span> removeResponseInterceptor<span class="token punctuation">;</span>
request<span class="token punctuation">.</span>clearPendingPool <span class="token operator">=</span> clearPendingPool<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> intactRequest<span class="token punctuation">,</span> request <span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br></div></div></li><li><p><strong>Step.2\uFF1A\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>axios.setConfig.js</code></strong></p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">/**
 * @param {axios} axios\u5B9E\u4F8B
 * @param {config} \u81EA\u5B9A\u4E49\u914D\u7F6E\u5BF9\u8C61\uFF0C\u53EF\u8986\u76D6\u6389\u9ED8\u8BA4\u7684\u81EA\u5B9A\u4E49\u914D\u7F6E
 */</span>
 <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">axios<span class="token punctuation">,</span> config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 
  <span class="token keyword">const</span> defaultConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">baseURL</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VUE_APP_BASEURL</span><span class="token punctuation">,</span>
      <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
      <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json;charset=UTF-8&#39;</span><span class="token punctuation">,</span>
          <span class="token string-property property">&#39;custom-defined-header-key&#39;</span><span class="token operator">:</span> <span class="token string">&#39;custom-defined-header-value&#39;</span><span class="token punctuation">,</span>
          <span class="token comment">// \u81EA\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF1A\u5BF9\u6240\u6709\u8BF7\u6C42\u65B9\u6CD5\u751F\u6548</span>
          <span class="token literal-property property">common</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// &#39;\u81EA\u5B9A\u4E49key&#39;: &#39;\u81EA\u5B9A\u4E49\u503C\u5BF9\u6240\u6709\u65B9\u6CD5&#39;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// \u81EA\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF1A\u53EA\u5BF9post\u65B9\u6CD5\u751F\u6548</span>
          <span class="token literal-property property">post</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// &#39;post-custom-key&#39;: &#39;custom value: only for post method&#39;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// \u81EA\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF1A\u53EA\u5BF9get\u65B9\u6CD5\u751F\u6548</span>
          <span class="token literal-property property">get</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// &#39;get-custom-key&#39;: &#39;custom value: only for get method&#39;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span>defaults<span class="token punctuation">,</span> defaultConfig<span class="token punctuation">,</span> config<span class="token punctuation">)</span>
  <span class="token keyword">return</span> axios
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li><li><p><strong>Step.3\uFF1A\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>axios.handlerError.js</code></strong></p><div class="language-js line-numbers-mode"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> response <span class="token punctuation">}</span> <span class="token operator">=</span> err<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    err<span class="token punctuation">.</span>code <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u6709response\u4F46\u6CA1\u6709response.status\u7684\u60C5\u51B5&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  err<span class="token punctuation">.</span>code <span class="token operator">=</span> response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">200</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u9519\u8BEF\u54CD\u5E94\u4E5F\u4F1A\u6709\u72B6\u6001\u7801\u4E3A200\u7684\u60C5\u51B5&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">400</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u8BF7\u6C42\u9519\u8BEF(400)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">401</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u672A\u6388\u6743\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55(401)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">403</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u62D2\u7EDD\u8BBF\u95EE(403)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">404</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u8BF7\u6C42\u51FA\u9519(404)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">408</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u8BF7\u6C42\u8D85\u65F6(408)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">500</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u670D\u52A1\u5668\u9519\u8BEF(500)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">501</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u670D\u52A1\u672A\u5B9E\u73B0(501)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">502</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u7F51\u7EDC\u9519\u8BEF(502)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">503</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u670D\u52A1\u4E0D\u53EF\u7528(503)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">504</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;\u7F51\u7EDC\u8D85\u65F6(504)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">505</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;HTTP\u7248\u672C\u4E0D\u53D7\u652F\u6301(505)&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      err<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">\u8FDE\u63A5\u51FA\u9519\uFF0C\u72B6\u6001\u7801\uFF1A(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>err<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)!</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> err<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div></li><li><p><strong>Step.4\uFF1A\u5728<code>src/utils/Axios/</code>\u65B0\u5EFA<code>axios.handleResponse.js</code></strong></p><div class="language-js line-numbers-mode"><pre><code><span class="token comment">// \u5904\u7406\u54CD\u5E94\u9519\u8BEF\u7801</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> status <span class="token operator">=</span> response<span class="token punctuation">.</span>status<span class="token punctuation">;</span>
  <span class="token comment">// \u5982\u679Chttp\u54CD\u5E94\u72B6\u6001\u7801response.status\u6B63\u5E38\uFF0C\u5219\u76F4\u63A5\u8FD4\u56DE\u6570\u636E</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> status <span class="token operator">&lt;=</span> <span class="token number">300</span><span class="token punctuation">)</span> <span class="token operator">||</span> status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// msg\u4E3A\u670D\u52A1\u7AEF\u8FD4\u56DE\u7684\u9519\u8BEF\u4FE1\u606F\uFF0C\u5B57\u6BB5\u540D\u81EA\u5B9A\u4E49\uFF0C\u6B64\u5904\u4EE5msg\u4E3A\u4F8B</span>
    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>msg<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">400</span><span class="token operator">:</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4001</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>server<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        message <span class="token operator">=</span> message <span class="token operator">||</span> <span class="token string">&quot;\u767B\u5F55\u8BBE\u5907\u6570\u91CF\u8D85\u51FA\u9650\u5236&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">403</span><span class="token operator">:</span>
        message <span class="token operator">=</span> message <span class="token operator">||</span> <span class="token string">&quot;\u672A\u767B\u5F55&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">404</span><span class="token operator">:</span>
        message <span class="token operator">=</span> message <span class="token operator">||</span> <span class="token string">&quot;\u8BF7\u6C42\u5730\u5740\u9519\u8BEF&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">412</span><span class="token operator">:</span>
        message <span class="token operator">=</span> message <span class="token operator">||</span> <span class="token string">&quot;\u672A\u627E\u5230\u6709\u6548session&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        message <span class="token operator">=</span> message <span class="token operator">||</span> err<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>msg
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      code<span class="token punctuation">,</span>
      message<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div></li></ul></div><div class="danger custom-block"><p class="custom-block-title">\u603B\u7ED3</p><ul><li>\u3010\u91CD\u70B9\u3011</li><li>\u3010\u96BE\u70B9\u3011</li><li>\u3010\u6CE8\u610F\u70B9\u3011</li></ul></div>`,5),o=[e];function c(l,u,r,i,k,b){return a(),s("div",null,o)}var g=n(t,[["render",c]]);export{d as __pageData,g as default};
